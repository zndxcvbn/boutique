<Window x:Class="Boutique.Views.MissingMastersDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lex="http://wpflocalizeextension.codeplex.com"
        xmlns:res="clr-namespace:Boutique.Resources"
        Title="{lex:Loc Key={x:Static res:LocalizationKeys+MissingMasters.Title}}"
        Width="550" Height="450"
        MinWidth="450" MinHeight="350"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        Background="{StaticResource Brush.CardBackground}">

  <Grid x:Name="RootGrid" Margin="20">
    <Grid.LayoutTransform>
      <ScaleTransform x:Name="RootScaleTransform" ScaleX="1" ScaleY="1" />
    </Grid.LayoutTransform>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <StackPanel Grid.Row="0" Margin="0,0,0,15">
      <TextBlock Text="{lex:Loc Key={x:Static res:LocalizationKeys+MissingMasters.Header}}"
                 FontSize="16"
                 FontWeight="SemiBold"
                 Foreground="{StaticResource Brush.Warning}"
                 Margin="0,0,0,8" />
      <TextBlock Text="{lex:Loc Key={x:Static res:LocalizationKeys+MissingMasters.Description}}"
                 TextWrapping="Wrap"
                 FontSize="13"
                 Foreground="{StaticResource Brush.TextSecondary}" />
    </StackPanel>

    <!-- Missing Masters and Affected Outfits List -->
    <Border Grid.Row="1"
            Background="{StaticResource Brush.CardBackground}"
            CornerRadius="6"
            BorderBrush="{StaticResource Brush.Border}"
            BorderThickness="1">
      <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
        <ItemsControl x:Name="MissingMastersItemsControl">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <StackPanel Margin="0,0,0,12">
                <!-- Missing Master Name -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                  <TextBlock Text="ðŸ“¦"
                             FontSize="14"
                             Margin="0,0,6,0"
                             VerticalAlignment="Center" />
                  <TextBlock Text="{Binding MasterFileName}"
                             FontSize="14"
                             FontWeight="SemiBold"
                             Foreground="{StaticResource Brush.Accent}" />
                </StackPanel>

                <!-- Affected Outfits -->
                <ItemsControl ItemsSource="{Binding AffectedOutfits}" Margin="24,0,0,0">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                        <TextBlock Text="â€¢"
                                   Foreground="{StaticResource Brush.TextSecondary}"
                                   Margin="0,0,8,0" />
                        <TextBlock Text="{Binding DisplayName}"
                                   Foreground="{StaticResource Brush.TextPrimary}"
                                   FontSize="13" />
                        <TextBlock Text="{Binding OrphanedCount, StringFormat=' ({0} orphaned armor(s))'}"
                                   Foreground="{StaticResource Brush.TextSecondary}"
                                   FontSize="12" />
                      </StackPanel>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Border>

    <!-- Summary -->
    <TextBlock Grid.Row="2"
               x:Name="SummaryText"
               Margin="0,12,0,0"
               FontSize="13"
               Foreground="{StaticResource Brush.TextSecondary}"
               TextWrapping="Wrap" />

    <!-- Buttons -->
    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
      <Button x:Name="AddMastersButton"
              Content="{lex:Loc Key={x:Static res:LocalizationKeys+MissingMasters.AddBack}}"
              Click="AddMastersButton_Click"
              MinWidth="160"
              Margin="0,0,10,0"
              Padding="14,8" />
      <Button x:Name="CleanPatchButton"
              Content="{lex:Loc Key={x:Static res:LocalizationKeys+MissingMasters.CleanPatch}}"
              Click="CleanPatchButton_Click"
              MinWidth="180"
              Padding="14,8" />
    </StackPanel>
  </Grid>
</Window>
